<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nim Music Player</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23FFD700'><path d='M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z'/></svg>">
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                    </svg>
                </div>
                <div class="logo-text">NMP</div>
            </div>
            
            <nav>
                <div class="nav-section">
                    <div class="nav-title">Library</div>
                    <div class="nav-item active" data-section="music">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                        </svg>
                        <span>Your Music</span>
                    </div>
                    <div class="nav-item" data-section="upload">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-8 8z"/>
                        </svg>
                        <span>How to Add Music</span>
                    </div>
                    <div class="nav-item" data-section="cache">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span>Cache Stats</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Playlists</div>
                    <div class="nav-item" data-section="favorites">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span>Favorites</span>
                    </div>
                    <div class="nav-item" data-section="playlists">
                        <div class="nav-item-content">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                            </svg>
                            <span>My Playlists</span>
                        </div>
                        <button class="sidebar-add-btn" onclick="window.musicPlayer.showModal('create-playlist-modal')" title="Create new playlist">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                        </button>
                    </div>
                    <!-- Dynamic playlists will be inserted here -->
                    <div id="sidebar-playlists">
                        <!-- Playlist items will be dynamically added here -->
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <h1 class="page-title">Your Music</h1>
                <div class="page-actions">
                    <!-- Future: Search, settings, etc. -->
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Now Playing Card -->
                <section class="now-playing-card">
                    <div class="track-info">
                        <div class="album-art">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                            </svg>
                        </div>
                        <div class="track-details">
                            <div class="track-title" id="track-title">Select a song to play</div>
                            <div class="track-artist" id="track-artist">Valve Studio Orchestra</div>
                        </div>
                    </div>

                    <div class="progress-section">
                        <div class="time-display">
                            <span id="current-time">0:00</span>
                            <span id="total-time">0:00</span>
                        </div>
                        <div class="progress-wrapper">
                            <div class="progress-track" id="progress-track">
                                <div class="progress-played" id="progress-played"></div>
                                <div class="progress-thumb" id="progress-thumb"></div>
                            </div>
                        </div>
                        <audio id="audio-player" preload="metadata">
                            Your browser does not support the audio element.
                        </audio>
                    </div>

                    <div class="controls-container">
                        <div class="player-controls">
                            <button class="control-btn secondary toggle" id="shuffle-btn" title="Shuffle">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
                                </svg>
                            </button>
                            <button class="control-btn secondary" id="prev-btn" title="Previous">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                                </svg>
                            </button>
                            <button class="control-btn primary" id="play-pause-btn" title="Play/Pause">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" id="play-pause-icon">
                                    <path d="M8 5v14l11-7z"/>
                                </svg>
                            </button>
                            <button class="control-btn secondary" id="next-btn" title="Next">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                                </svg>
                            </button>
                            <button class="control-btn secondary toggle" id="repeat-btn" title="Repeat Off" data-repeat="off">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="repeat-icon">
                                    <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
                                </svg>
                            </button>
                            <button class="control-btn secondary toggle" id="volume-btn" title="Volume">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" id="volume-icon">
                                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Volume Control Popup -->
                        <div class="volume-popup" id="volume-popup">
                            <div class="volume-control">
                                <div class="volume-slider-wrapper">
                                    <div class="volume-track" id="volume-track">
                                        <div class="volume-fill" id="volume-fill"></div>
                                        <div class="volume-handle" id="volume-handle"></div>
                                    </div>
                                </div>
                                <span class="volume-percentage" id="volume-percentage">100%</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Music Library Section -->
                <section class="content-section" id="music-section">
                    <div class="playlist-section">
                        <div class="playlist-header">
                            <h2 class="playlist-title">
                                Music Library
                                <span class="song-count" id="song-count">Loading...</span>
                            </h2>
                        </div>

                        <ul class="song-list" id="song-list">
                            <div class="loading-state">
                                <div class="loading-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                                    </svg>
                                </div>
                                <div class="loading-text">Loading your music...</div>
                            </div>
                        </ul>
                    </div>
                </section>

                <!-- How to Add Music Section -->
                <section class="content-section hidden" id="upload-section">
                    <div class="playlist-section">
                        <div class="playlist-header">
                            <h2 class="playlist-title">How to Add Music to Your Library</h2>
                            <p class="upload-instructions">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: text-bottom; margin-right: 4px;">
                                    <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-8 8z"/>
                                </svg>
                                Choose the method that works best for you to add music to your library.
                            </p>
                        </div>
                        
                        <div class="upload-area">
                            <div class="upload-method">
                                <div class="method-card">
                                    <div class="method-icon">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"/>
                                        </svg>
                                    </div>
                                    <div class="method-content">
                                        <h3>Local Music Folder</h3>
                                        <p>Copy your music files directly to the music folder on your system.</p>
                                        <div class="method-steps">
                                            <ol>
                                                <li>Open your file manager</li>
                                                <li>Navigate to: <code id="music-directory-path">[Loading...]</code></li>
                                                <li>Copy your music files (.mp3, .flac, .wav, .m4a, .ogg) to this folder</li>
                                                <li>Refresh this page to see your music</li>
                                            </ol>
                                        </div>
                                        <div class="method-note">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: text-bottom; margin-right: 4px;">
                                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            <strong>Recommended for:</strong> Large files, FLAC albums, personal collections
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="upload-method">
                                <div class="method-card">
                                    <div class="method-icon">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
                                        </svg>
                                    </div>
                                    <div class="method-content">
                                        <h3>GitHub Repository</h3>
                                        <p>Store your music in a GitHub repository for cloud access and sharing.</p>
                                        <div class="method-steps">
                                            <ol>
                                                <li>Create a GitHub repository for your music</li>
                                                <li>Upload your music files to the repository</li>
                                                <li>Update the <code>.env</code> file with your repository details</li>
                                                <li>Set <code>MUSIC_SOURCE=github</code> and restart the server</li>
                                            </ol>
                                        </div>
                                        <div class="method-note">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: text-bottom; margin-right: 4px;">
                                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            <strong>Recommended for:</strong> Cloud access, sharing, smaller collections
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="current-config">
                            <h4>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: text-bottom; margin-right: 6px;">
                                    <path d="M9 12h6v-2H9v2zm0 4h6v-2H9v2zm0-8h6V6H9v2zm-4 0h2V6H5v2zm0 4h2v-2H5v2zm0 4h2v-2H5v2z"/>
                                </svg>
                                Current Configuration
                            </h4>
                            <div class="config-info">
                                <div class="config-item">
                                    <strong>Music Source:</strong> <span class="config-value" id="current-source">Loading...</span>
                                </div>
                                <div class="config-item">
                                    <strong>Music Directory:</strong> <span class="config-value" id="current-directory">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- My Playlists Section -->
                <section class="content-section hidden" id="playlists-section">
                    <div class="playlist-section">
                        <div class="playlist-header">
                            <h2 class="playlist-title">My Playlists</h2>
                            <button class="control-btn" id="create-playlist-btn" style="padding: 8px 16px; font-size: 12px; margin-top: 16px;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                New Playlist
                            </button>
                        </div>
                        
                        <div class="playlists-grid" id="playlists-grid">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                                    </svg>
                                </div>
                                <div class="empty-state-title">No playlists yet</div>
                                <div class="empty-state-description">
                                    Create your first playlist or upload M3U files.
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cache Stats Section -->
                <section class="content-section hidden" id="cache-section">
                    <div class="playlist-section">
                        <div class="playlist-header">
                            <h2 class="playlist-title">
                                Cache Statistics
                                <button class="control-btn" id="clear-cache-btn" style="margin-left: auto; padding: 8px 16px; font-size: 12px;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </svg>
                                    Clear Cache
                                </button>
                            </h2>
                        </div>
                        
                        <div class="cache-stats" id="cache-stats">
                            <div class="loading-state">
                                <div class="loading-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                                    </svg>
                                </div>
                                <div class="loading-text">Loading cache statistics...</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Favorites Section -->
                <section class="content-section hidden" id="favorites-section">
                    <div class="playlist-section">
                        <div class="playlist-header">
                            <h2 class="playlist-title">
                                Favorites
                                <span class="song-count" id="favorites-count">0 songs</span>
                            </h2>
                        </div>

                        <ul class="song-list" id="favorites-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                    </svg>
                                </div>
                                <div class="empty-state-title">No favorites yet</div>
                                <div class="empty-state-description">
                                    Click the heart icon next to songs to add them to your favorites.
                                </div>
                            </div>
                        </ul>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Create Playlist Modal -->
    <div class="modal-overlay" id="create-playlist-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create New Playlist</h3>
                <button class="modal-close" onclick="window.musicPlayer.closeModal('create-playlist-modal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Playlist Name</label>
                    <input type="text" class="form-input" id="playlist-name-input" placeholder="Enter playlist name...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.musicPlayer.closeModal('create-playlist-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="window.musicPlayer.confirmCreatePlaylist()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Create Playlist
                </button>
            </div>
        </div>
    </div>

    <!-- Add to Playlist Modal -->
    <div class="modal-overlay" id="add-to-playlist-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add to Playlist</h3>
                <button class="modal-close" onclick="window.musicPlayer.closeModal('add-to-playlist-modal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="add-song-text" style="margin-bottom: 16px; color: var(--text-secondary);"></p>
                <div class="playlist-list" id="playlist-selection">
                    <!-- Playlist options will be populated here -->
                </div>
                <div style="margin-top: 16px;">
                    <button class="btn btn-secondary" onclick="window.musicPlayer.showCreatePlaylistFromAdd()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        Create New Playlist
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.musicPlayer.closeModal('add-to-playlist-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="window.musicPlayer.confirmAddToPlaylist()" disabled id="add-to-playlist-btn">Add to Playlist</button>
            </div>
        </div>
    </div>

    <!-- Delete Playlist Modal -->
    <div class="modal-overlay" id="delete-playlist-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Delete Playlist</h3>
                <button class="modal-close" onclick="window.musicPlayer.closeModal('delete-playlist-modal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="delete-playlist-text" style="color: var(--text-primary);"></p>
                <p style="color: var(--text-muted); font-size: 14px; margin-top: 8px;">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.musicPlayer.closeModal('delete-playlist-modal')">Cancel</button>
                <button class="btn btn-danger" onclick="window.musicPlayer.confirmDeletePlaylist()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="M19,6V20a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6M8,6V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2V6"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    Delete Playlist
                </button>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>